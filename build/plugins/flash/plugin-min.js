KISSY.Editor.add("flash",function(n){var f=KISSY.Editor,o=KISSY,w=o.Event,x=f.ContextMenu,p=o.Node,q=f.BubbleView,y=f.TripleButton,z=f.SimpleOverlay,j=n.htmlDataProcessor,k="ke_flash",r=f.Utils.getFlashUrl,s=j&&j.dataFilter,A=["img."+k];f.Flash||function(){function d(a){this.editor=a;this._init()}function i(a){return a._4e_ascendant(function(b){return b._4e_name()==="img"&&!!b.hasClass(k)},true)}var h=/\.swf(?:$|\?)/i;d.isFlashEmbed=function(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||
h.test(a.src||"")};o.augment(d,{_config:function(){var a=this.editor;a._toolbars=a._toolbars||{};a._toolbars.flash=this;this._cls=k;this._type="flash";this._title="\u7f16\u8f91flash";this._bodyHtml="<div><p><label>\u5730\u5740\ufffd?<input class='ke-flash-url' style='width:280px' /></label></p><p style='margin:5px 0'><label>\u5bbd\u5ea6\ufffd?<input class='ke-flash-width' style='width:110px' /></label>&nbsp;&nbsp;<label>\u9ad8\u5ea6\ufffd?input class='ke-flash-height' style='width:110px' /></label></p>";
this._footHtml="<button class='ke-flash-ok'>\u786e\u5b9a</button> <button class='ke-flash-cancel'>\u53d6\u6d88</button></div>";this._contentCls="ke-toolbar-flash";this._tip="Flash";this._contextMenu=t;this._flashRules=A},_init:function(){var a=this,b=a.editor,e={};a._config();a.el=new y({container:b.toolBarDiv,contentCls:a._contentCls,title:a._tip});a.el.on("click",a.show,this);for(var c in t)(function(g){e[g]=function(){b.fire("save");a._contextMenu[g](b);b.fire("save")}})(c);x.register(b.document,
{rules:a._flashRules,width:"120px",funcs:e});q.attach({pluginName:a._type,pluginInstance:a});w.on(b.document,"dblclick",a._dbclick,a);f.Utils.lazyRun(this,"_prepareShow","_realShow")},_getFlashUrl:function(a){return r(a)},_updateTip:function(a,b){b=this.editor.restoreRealElement(b);a.html(this._getFlashUrl(b));a.attr("href",this._getFlashUrl(b))},_dbclick:function(a){var b=new p(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.selectedFlash=b;this.show();a.halt()}},_prepareShow:function(){var a=
this;a.d=new z({title:a._title,width:"350px",mask:true});a.d.on("hide",function(){a.selectedFlash=null});a.d.body.html(a._bodyHtml);a.d.foot.html(a._footHtml);a._initD()},_realShow:function(){this.d.show()},_updateD:function(){var a=this.editor,b=this.selectedFlash;if(b){a=a.restoreRealElement(b);a.attr("width")&&this.dWidth.val(parseInt(a.attr("width")));a.attr("height")&&this.dHeight.val(parseInt(a.attr("height")));this.dUrl.val(r(a))}else{this.dUrl.val("");this.dWidth.val("");this.dHeight.val("")}},
show:function(){this._prepareShow();this._updateD()},_initD:function(){var a=this,b=a.d;a.dHeight=b.el.one(".ke-flash-height");a.dWidth=b.el.one(".ke-flash-width");a.dUrl=b.el.one(".ke-flash-url");var e=b.el.one(".ke-flash-ok");b=b.el.one(".ke-flash-cancel");e.on("click",a._gen,a);b.on("click",function(){a.d.hide()})},_getDURl:function(){return this.dUrl.val()},_getDWidth:function(){return this.dWidth.val()},_getDHeight:function(){return this.dHeight.val()},_gen:function(){var a=this.editor,b=this._getDURl(),
e=this._getDWidth(),c=this._getDHeight();b="<object "+(e?" width='"+e+"' ":" ")+(c?" height='"+c+"' ":" ")+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"  codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"><param name="quality" value="high" /><param name="movie" value="'+b+'" /><embed '+(e?" width='"+e+"' ":" ")+(c?" height='"+c+"' ":" ")+'pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high"  src="'+b+'"  type="application/x-shockwave-flash"/></object>';
e=new p(b,null,a.document);b=a.createFakeElement?a.createFakeElement(e,this._cls,this._type,true,b):e;a.insertElement(b);this.selectedFlash&&a.getSelection().selectElement(b);this.d.hide()}});f.Flash=d;d.registerBubble=function(a,b,e){q.register({pluginName:a,func:e,init:function(){var c=this,g=c.el;g.html(b+'  <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var u=g.one(".ke-bubbleview-url"),v=g.one(".ke-bubbleview-change");g=g.one(".ke-bubbleview-remove");v._4e_unselectable();u._4e_unselectable();g._4e_unselectable();v.on("click",function(l){c._plugin.selectedFlash=c._selectedEl;c._plugin.show();l.halt()});g.on("click",function(l){var m=c._plugin;c._selectedEl._4e_remove();m.editor.notifySelectionChange();l.halt()});c.on("afterVisibleChange",function(l){var m=c._selectedEl;l.newVal&&m&&c._plugin._updateTip(u,m)})}})};d.registerBubble("flash","Flash \u7f51\u5740\ufffd?",
i);var t={"\u7f16\u8f91Flash":function(a){var b=a.getSelection();b=b&&b.getStartElement();b=i(b);a=a._toolbars.flash;a.selectedFlash=b;a.show()}}}();s&&s.addRules({elements:{object:function(d){var i=d.attributes,h;h=i.classid&&String(i.classid).toLowerCase();i=k;if(!h){for(h=0;h<d.children.length;h++)if(d.children[h].name=="embed"){if(!f.Flash.isFlashEmbed(d.children[h]))return null;return j.createFakeParserElement(d,i,"flash",true)}return null}return j.createFakeParserElement(d,i,"flash",true)},
embed:function(d){if(!f.Flash.isFlashEmbed(d))return null;return j.createFakeParserElement(d,k,"flash",true)}}},5);n.addPlugin(function(){new f.Flash(n)})});
